{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/dpi/Desktop/_Projects/_Dev/baitlist/lib/supabase-admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\n/**\n * Server-only Supabase admin client (service role).\n * Requires SUPABASE_SERVICE_ROLE_KEY in env.\n */\nexport function createAdminClient() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!url) throw new Error('NEXT_PUBLIC_SUPABASE_URL is not set')\n  if (!serviceRoleKey) throw new Error('SUPABASE_SERVICE_ROLE_KEY is not set')\n\n  return createClient(url, serviceRoleKey, {\n    auth: {\n      persistSession: false,\n      autoRefreshToken: false,\n    },\n  })\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAMO,SAAS;IACd,MAAM;IACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;IAE5D;;IACA,IAAI,CAAC,gBAAgB,MAAM,IAAI,MAAM;IAErC,OAAO,IAAA,gMAAY,EAAC,KAAK,gBAAgB;QACvC,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QACpB;IACF;AACF"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/dpi/Desktop/_Projects/_Dev/baitlist/app/api/waitlist/signup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createAdminClient } from '@/lib/supabase-admin'\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { \n      waitlistId, \n      email, \n      name, \n      company, \n      role, \n      companySize,\n      answerProblem, \n      answerWorkflow, \n      answerAlternatives, \n      answerSuccess, \n      answerSource\n    } = await req.json()\n\n    // 1. Validate required fields\n    if (!waitlistId || !email || !name || !answerProblem || !answerWorkflow || \n        !answerAlternatives || !answerSuccess || !answerSource) {\n      return NextResponse.json(\n        { error: 'Missing required fields' }, \n        { status: 400 }\n      )\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { error: 'Invalid email format' }, \n        { status: 400 }\n      )\n    }\n\n    // Use admin client to bypass RLS for public signups\n    const supabase = createAdminClient()\n\n    // 2. Check if waitlist exists\n    const { data: waitlist, error: waitlistError } = await supabase\n      .from('waitlists')\n      .select('id, name')\n      .eq('id', waitlistId)\n      .single()\n\n    if (waitlistError || !waitlist) {\n      return NextResponse.json(\n        { error: 'Waitlist not found' }, \n        { status: 404 }\n      )\n    }\n\n    // 3. Check if email already signed up to this waitlist\n    const { data: existing } = await supabase\n      .from('signups')\n      .select('id')\n      .eq('waitlist_id', waitlistId)\n      .eq('email', email)\n      .single()\n\n    if (existing) {\n      return NextResponse.json(\n        { error: 'Email already registered for this waitlist' }, \n        { status: 400 }\n      )\n    }\n\n    // 4. Create signup with pending status\n    const { data: signup, error: insertError } = await supabase\n      .from('signups')\n      .insert({\n        waitlist_id: waitlistId,\n        email: email,\n        name: name,\n        company: company || null,\n        role: role || null,\n        company_size: companySize || null,\n        answer_problem: answerProblem,\n        answer_workflow: answerWorkflow,\n        answer_alternatives: answerAlternatives,\n        answer_success: answerSuccess,\n        answer_source: answerSource,\n        status: 'pending',\n        llm_score: null,\n        position: null\n      })\n      .select()\n      .single()\n\n    if (insertError) {\n      console.error('Signup creation error:', insertError)\n      return NextResponse.json(\n        { error: 'Failed to create signup' }, \n        { status: 500 }\n      )\n    }\n\n    // 5. Trigger async scoring (don't await - happens in background)\n    const baseUrl = process.env.NEXT_PUBLIC_URL || 'http://localhost:3000'\n    fetch(`${baseUrl}/api/score-signup`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        signupId: signup.id,\n        waitlistId: waitlistId,\n        waitlistName: waitlist.name,\n        answers: {\n          problem: answerProblem,\n          workflow: answerWorkflow,\n          alternatives: answerAlternatives,\n          success: answerSuccess,\n          source: answerSource\n        }\n      })\n    }).catch(err => {\n      console.error('Error triggering scoring:', err)\n    })\n\n    // 6. Return success\n    return NextResponse.json({\n      success: true,\n      signupId: signup.id,\n      message: 'Processing your submission...'\n    })\n\n  } catch (error: any) {\n    console.error('Signup error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' }, \n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EACJ,UAAU,EACV,KAAK,EACL,IAAI,EACJ,OAAO,EACP,IAAI,EACJ,WAAW,EACX,aAAa,EACb,cAAc,EACd,kBAAkB,EAClB,aAAa,EACb,YAAY,EACb,GAAG,MAAM,IAAI,IAAI;QAElB,8BAA8B;QAC9B,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,QAAQ,CAAC,iBAAiB,CAAC,kBACrD,CAAC,sBAAsB,CAAC,iBAAiB,CAAC,cAAc;YAC1D,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,wBAAwB;QACxB,MAAM,aAAa;QACnB,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;YAC3B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,oDAAoD;QACpD,MAAM,WAAW,IAAA,+IAAiB;QAElC,8BAA8B;QAC9B,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,aACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,YACT,MAAM;QAET,IAAI,iBAAiB,CAAC,UAAU;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,uDAAuD;QACvD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,WACL,MAAM,CAAC,MACP,EAAE,CAAC,eAAe,YAClB,EAAE,CAAC,SAAS,OACZ,MAAM;QAET,IAAI,UAAU;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,uCAAuC;QACvC,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAChD,IAAI,CAAC,WACL,MAAM,CAAC;YACN,aAAa;YACb,OAAO;YACP,MAAM;YACN,SAAS,WAAW;YACpB,MAAM,QAAQ;YACd,cAAc,eAAe;YAC7B,gBAAgB;YAChB,iBAAiB;YACjB,qBAAqB;YACrB,gBAAgB;YAChB,eAAe;YACf,QAAQ;YACR,WAAW;YACX,UAAU;QACZ,GACC,MAAM,GACN,MAAM;QAET,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iEAAiE;QACjE,MAAM,UAAU,6DAA+B;QAC/C,MAAM,GAAG,QAAQ,iBAAiB,CAAC,EAAE;YACnC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU,OAAO,EAAE;gBACnB,YAAY;gBACZ,cAAc,SAAS,IAAI;gBAC3B,SAAS;oBACP,SAAS;oBACT,UAAU;oBACV,cAAc;oBACd,SAAS;oBACT,QAAQ;gBACV;YACF;QACF,GAAG,KAAK,CAAC,CAAA;YACP,QAAQ,KAAK,CAAC,6BAA6B;QAC7C;QAEA,oBAAoB;QACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,OAAO,EAAE;YACnB,SAAS;QACX;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}