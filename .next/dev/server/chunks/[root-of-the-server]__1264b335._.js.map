{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/dpi/Desktop/_Projects/_Dev/baitlist/lib/supabase.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  // #region agent log\n  fetch('http://127.0.0.1:7244/ingest/382c8fcb-0fa3-42bd-87b1-6fecf8b7a1fb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'lib/supabase.ts:createClient',message:'createClient called',data:{envUrl:!!process.env.NEXT_PUBLIC_SUPABASE_URL,envKey:!!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'H3'})}).catch(()=>{});\n  // #endregion\n\n  const cookieStore = await cookies()\n\n  // #region agent log\n  fetch('http://127.0.0.1:7244/ingest/382c8fcb-0fa3-42bd-87b1-6fecf8b7a1fb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'lib/supabase.ts:afterCookies',message:'cookies() result type after await',data:{type:typeof cookieStore,isPromise:cookieStore instanceof Promise,hasGet:typeof cookieStore?.get,hasGetAll:typeof cookieStore?.getAll},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'H1'})}).catch(()=>{});\n  // #endregion\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          // #region agent log\n          try { const val = cookieStore.get(name)?.value; fetch('http://127.0.0.1:7244/ingest/382c8fcb-0fa3-42bd-87b1-6fecf8b7a1fb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'lib/supabase.ts:get',message:'cookie get called',data:{name,hasValue:!!val},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'H2'})}).catch(()=>{}); return val; } catch(e:any) { fetch('http://127.0.0.1:7244/ingest/382c8fcb-0fa3-42bd-87b1-6fecf8b7a1fb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'lib/supabase.ts:get:error',message:'cookie get error',data:{name,error:e?.message},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'H1'})}).catch(()=>{}); throw e; }\n          // #endregion\n        },\n        set(name: string, value: string, options: any) {\n          try {\n            cookieStore.set(name, value, options)\n          } catch {\n            // Ignore errors in Server Components\n          }\n        },\n        remove(name: string, options: any) {\n          try {\n            cookieStore.set(name, '', { ...options, maxAge: 0 })\n          } catch {\n            // Ignore errors in Server Components\n          }\n        },\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,oBAAoB;IACpB,MAAM,qEAAoE;QAAC,QAAO;QAAO,SAAQ;YAAC,gBAAe;QAAkB;QAAE,MAAK,KAAK,SAAS,CAAC;YAAC,UAAS;YAA+B,SAAQ;YAAsB,MAAK;gBAAC,QAAO,CAAC;gBAAsC,QAAO,CAAC;YAA0C;YAAE,WAAU,KAAK,GAAG;YAAG,WAAU;YAAgB,OAAM;YAAW,cAAa;QAAI;IAAE,GAAG,KAAK,CAAC,KAAK;IACza,aAAa;IAEb,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,oBAAoB;IACpB,MAAM,qEAAoE;QAAC,QAAO;QAAO,SAAQ;YAAC,gBAAe;QAAkB;QAAE,MAAK,KAAK,SAAS,CAAC;YAAC,UAAS;YAA+B,SAAQ;YAAoC,MAAK;gBAAC,MAAK,OAAO;gBAAY,WAAU,uBAAuB;gBAAQ,QAAO,OAAO,aAAa;gBAAI,WAAU,OAAO,aAAa;YAAM;YAAE,WAAU,KAAK,GAAG;YAAG,WAAU;YAAgB,OAAM;YAAW,cAAa;QAAI;IAAE,GAAG,KAAK,CAAC,KAAK;IAC3d,aAAa;IAEb,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,oBAAoB;gBACpB,IAAI;oBAAE,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBAAO,MAAM,qEAAoE;wBAAC,QAAO;wBAAO,SAAQ;4BAAC,gBAAe;wBAAkB;wBAAE,MAAK,KAAK,SAAS,CAAC;4BAAC,UAAS;4BAAsB,SAAQ;4BAAoB,MAAK;gCAAC;gCAAK,UAAS,CAAC,CAAC;4BAAG;4BAAE,WAAU,KAAK,GAAG;4BAAG,WAAU;4BAAgB,OAAM;4BAAW,cAAa;wBAAI;oBAAE,GAAG,KAAK,CAAC,KAAK;oBAAI,OAAO;gBAAK,EAAE,OAAM,GAAO;oBAAE,MAAM,qEAAoE;wBAAC,QAAO;wBAAO,SAAQ;4BAAC,gBAAe;wBAAkB;wBAAE,MAAK,KAAK,SAAS,CAAC;4BAAC,UAAS;4BAA4B,SAAQ;4BAAmB,MAAK;gCAAC;gCAAK,OAAM,GAAG;4BAAO;4BAAE,WAAU,KAAK,GAAG;4BAAG,WAAU;4BAAgB,OAAM;4BAAW,cAAa;wBAAI;oBAAE,GAAG,KAAK,CAAC,KAAK;oBAAI,MAAM;gBAAG;YACvwB,aAAa;YACf;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,IAAI;oBACF,YAAY,GAAG,CAAC,MAAM,OAAO;gBAC/B,EAAE,OAAM;gBACN,qCAAqC;gBACvC;YACF;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,IAAI;oBACF,YAAY,GAAG,CAAC,MAAM,IAAI;wBAAE,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBACpD,EAAE,OAAM;gBACN,qCAAqC;gBACvC;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///Users/dpi/Desktop/_Projects/_Dev/baitlist/app/api/create-checkout/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport Stripe from 'stripe'\nimport { createClient } from '@/lib/supabase'\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  throw new Error('STRIPE_SECRET_KEY is not set')\n}\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: '2025-12-15.clover',\n  typescript: true,\n})\n\nexport async function POST(req: NextRequest) {\n  try {\n    // Get current user\n    const supabase = await createClient()\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Validate price ID\n    const priceId = process.env.STRIPE_PRICE_ID_PRO\n    if (!priceId) {\n      console.error('STRIPE_PRICE_ID_PRO is not set')\n      return NextResponse.json(\n        { error: 'Server configuration error' },\n        { status: 500 }\n      )\n    }\n\n    // Get the base URL for redirects\n    const origin = req.headers.get('origin') || process.env.NEXT_PUBLIC_URL || 'http://localhost:3000'\n\n    // Create Stripe checkout session\n    const session = await stripe.checkout.sessions.create({\n      mode: 'subscription',\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price: priceId,\n          quantity: 1,\n        },\n      ],\n      success_url: `${origin}/dashboard?success=true`,\n      cancel_url: `${origin}/dashboard`,\n      metadata: {\n        user_id: user.id,\n        email: user.email || '',\n      },\n      customer_email: user.email || undefined,\n    })\n\n    return NextResponse.json({ url: session.url })\n  } catch (error: any) {\n    console.error('Error creating checkout session:', error)\n    \n    // Handle Stripe-specific errors\n    if (error.type === 'StripeInvalidRequestError') {\n      return NextResponse.json(\n        { error: 'Invalid request to payment provider' },\n        { status: 400 }\n      )\n    }\n\n    return NextResponse.json(\n      { error: 'Failed to create checkout session' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAClC,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,SAAS,IAAI,mKAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IACvD,YAAY;IACZ,YAAY;AACd;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,mBAAmB;QACnB,MAAM,WAAW,MAAM,IAAA,iIAAY;QACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAExE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB;QAC/C,IAAI,CAAC,SAAS;YACZ,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iCAAiC;QACjC,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,0EAA4C;QAE3E,iCAAiC;QACjC,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,MAAM;YACN,sBAAsB;gBAAC;aAAO;YAC9B,YAAY;gBACV;oBACE,OAAO;oBACP,UAAU;gBACZ;aACD;YACD,aAAa,GAAG,OAAO,uBAAuB,CAAC;YAC/C,YAAY,GAAG,OAAO,UAAU,CAAC;YACjC,UAAU;gBACR,SAAS,KAAK,EAAE;gBAChB,OAAO,KAAK,KAAK,IAAI;YACvB;YACA,gBAAgB,KAAK,KAAK,IAAI;QAChC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK,QAAQ,GAAG;QAAC;IAC9C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oCAAoC;QAElD,gCAAgC;QAChC,IAAI,MAAM,IAAI,KAAK,6BAA6B;YAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsC,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}